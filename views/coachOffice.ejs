<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Home</title>
      <link rel="stylesheet" href="/coachOffice.css">
      <link rel="stylesheet" href="/navbar.css">
      <link rel="stylesheet" href="/weather.css">
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Winky+Rough:ital,wght@0,300..900;1,300..900&display=swap"
            rel="stylesheet">
</head>

<body>
 <div class="container"><%- include('partials/navbar') %> </div>

<div class="main-content">
    <div class="chat-layout">
        <div class="avatar-side">
            <div class="welcome-text">
                <%= catName || "Your Cat" %>'s Office
            </div>
            <img class="cat-avatar" src="/<%= catAvatar %>" alt="Cat Avatar" />
        </div>

        <div class="chat-container">
            <h3>Chat with <%= catName || "Your Cat" %>, Your Cat Fitness Coach</h3>
            <div class="chat-messages" id="chat-messages">
                <div class="message coach-message clearfix">
                    <p>Meow there! I'm <%= catName || "Your Cat" %>, your purr-sonal fitness coach. How can I help you get fit today?</p>
                </div>
            </div>
            <div class="message-input">
                <textarea id="message-text" placeholder="Type your message here..." rows="2"></textarea>
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>
</div>

    <script>
//         const chatMessages = document.getElementById('chat-messages')
//         const messageText = document.getElementById('message-text')
//         const sendButton = document.getElementById('send-button')

//         sendButton.addEventListener('click', sendMessage);

// function sendMessage(){
//     console.log('click')
//     const message = messageText.value.trim()
//     if (!message) return;
//     addMessageToChat(message,'user-message') //Add message to chat as a user message
//     messageText.value = '';
// }

//         // DOM elements
//         const chatMessages = document.getElementById('chat-messages');
//         const messageText = document.getElementById('message-text');
//         const sendButton = document.getElementById('send-button');

//         // Initialize chat functionality
//         document.addEventListener('DOMContentLoaded', () => {
//             // Set up event listeners
//             sendButton.addEventListener('click', sendMessage);
//             messageText.addEventListener('keypress', (e) => {
//                 if (e.key === 'Enter' && !e.shiftKey) {
//                     e.preventDefault();
//                     sendMessage();
//                 }
//             });
//         });

//         // Function to send message
//         function sendMessage() {
//             const message = messageText.value.trim();
//             if (!message) return;

//             // Add user message to chat
//             addMessageToChat(message, 'user-message');
            
//             // Clear input
//             messageText.value = '';
            
//             // Show loading indicator
//             const loadingDiv = document.createElement('div');
//             loadingDiv.className = 'loading clearfix';
//             loadingDiv.textContent = 'Whiskers is typing...';
//             chatMessages.appendChild(loadingDiv);
            
//             // Scroll to bottom
//             chatMessages.scrollTop = chatMessages.scrollHeight;
            
//             // Get response from cat coach
//             getCatCoachResponse(message)
//                 .then(response => {
//                     // Remove loading indicator
//                     chatMessages.removeChild(loadingDiv);
                    
//                     // Add coach response
//                     addMessageToChat(response, 'coach-message');
//                 })
//                 .catch(error => {
//                     // Remove loading indicator
//                     chatMessages.removeChild(loadingDiv);
                    
//                     // Add error message
//                     addMessageToChat("Meow! I'm having trouble connecting right now. Please try again later.", 'coach-message');
//                     console.error('Error:', error);
//                 });
//         }

//         // Function to add message to chat
//         function addMessageToChat(text, className) {
//             const messageDiv = document.createElement('div');
//             messageDiv.className = `message ${className} clearfix`;
            
//             const paragraph = document.createElement('p');
//             paragraph.textContent = text;
            
//             messageDiv.appendChild(paragraph);
//             chatMessages.appendChild(messageDiv);
            
//             // Scroll to bottom
//             chatMessages.scrollTop = chatMessages.scrollHeight;
//         }

// //Function to get the AI Coach's response
// async function getCatCoachResponse(userMessage) {
//   try {
//     console.log('Sending message to server:', userMessage);
    
//     const response = await fetch('/api/chat', {
//       method: 'POST',
//       headers: {
//         'Content-Type': 'application/json'
//       },
//       body: JSON.stringify({ message: userMessage })
//     });
    
//     console.log('Server response status:', response.status);
    
//     if (!response.ok) {
//       // Try to get the error message if available
//       const errorData = await response.json().catch(() => ({}));
//       console.error('Server response error:', errorData);
//       throw new Error('Failed to get response');
//     }
    
//     const data = await response.json();
//     console.log('Response received successfully');
//     return data.response;
//   } catch (error) {
//     console.error('Error in getCatCoachResponse:', error);
//     throw error;
//   }
// }
    </script>

    <script src="/js/coachOffice.js"></script>
</body>

</html>